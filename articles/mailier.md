Одна из самых больших проблем в программировании - это дублирование кода. Фактически, большая половина того что пишется о правильном программировании, описывает. как бороться с дублированием, последствиями дублирования или последствиями борьбы с дублированиям. За последнее время, удалось достигнуть значительных успехов в этом. Благодаря composer и open source, многие вещи можно не выдумывать, а взять уже готовые реализации.
 
С другой стороны, когда мы говорим про архитектуры программ и приложений, то тут все по другому. Конечно существуют паттерны программирования, которые говорят какими подходами стоит руководствоваться, но паттерны не описывают целиком  архитектуру. Конечно в каждой задаче есть свои особенности, но не так часто есть особенности, которые заставляют написать код, который нельзя было бы использовать несколько раз. Причины, почему пишется так много кода, я вижу в лени, желании побыстрее окончить работу и отсутствие в свободном доступе полных данных о существующих архитектурных решениях. Поэтому я решил описать некоторые сервисы, которые я разрабатывал.

Я опишу структуру системы подписок, которую я разработал некоторое время назад. 

Будет Создаться система подписок для посетителей сайта. Обычно система подписок представляет из себя список пользователей, которые оставили свои контакты. Наша же система будет сложнее: она будет содержать несколько листов с пользователями. для простоты изложения сейчас будем считать, что листа 2. Обычно, переход от 1 к 2 - является очень сложным. Переход от 2 к 3 и более - уже тривиален. Пользователь сможет подписаться на одну, на обе или ни на одну из подписок. Кроме этого человек сможет отписываться от конкретной подписки, и потом подписываться еще раз.
Мы будем отправлять письмо по списку целиком или по его половине. Мы можем формировать одинаковые письма для всех пользователей или формировать письмо на основе данных о пользователе.
Нас будет интересовать следующая статистика: сколько писем отправлено, в какое конкретно время, сколько писем получено, сколько писем открыто, на какие ссылки в письме были нажатия, какое было поведение у пользователей, которые перешли на сайт из письма.
Мы не можем быть уверены в тех людях, которые создают письма, поэтому после создания письма попадают на одобрение старшим администраторам. И только после одобрения старшим администратором письма уходят клиентам.

Сама система развивалась итерационно:
1 Вначале была сделана первая версия, которая позволяла создавать и редактировать письма. После создания письма, редактором нажимается кнопка отправить, и письмо рассылается на всех клиентов. Новое письмо можно или сделать заново, или склонировать одно из предыдущих. - Это результат работы в сжатые сроки и ответ на неудобный механизм создания писем, который существовал до сосоздания системы.
2 Потом была добавлена очень рассылки для размазывания нагрузки. После создания письма, редактором нажимается кнопка отправить, и письмо попадает в очередь в БД. По мере очереди письма отправляются. - Это ответ на подписание сервера при отправке письма
3 Появляется механизм одобрения писем. - Это ответ на ошибки в письмах, которые уходили клиентам
4 Появляется механизм разнесения писем по времени. - Это ответ на жалобы администраторов на то, что для разных регионов нужно отправлять письма в разное время
5 Появляется механизм проверки ссылок писем. - Это ответ на ошибки в письмах, которые уходили клиентам + упрощение работы администраторов
6 Появляется разделение прав + меняется система выбора группы подписчиков. Фактически теперь Старший администратор создает письмо, назначает лист рассылки по которому оно будет рассылаться и кто это письмо будет проверять, а обычной администратор может только клонировать письмо с сохранением всех параметров, поменять время отправки и содержание. - Это ответ на ошибки в выборе списка подписчиков
7 Появляется возможность создавать персонализированные письма. - Это попытка повышения конверсии, за счет использования собранных статистических данных
8 Появляется возможность создавать А\В тестирование. - Это ответ на запросы администраторов о том, что проводить исследование аудитории стало более удобно.

Можно заметить что структура приложения менялась очень очень сильно. Но для упрощения рассказа я буду все описывать с точки зрения финальной версии.

Приложение работало в следующем окружении: приложение стоит на сервере с другими приложениеми, база данных mysql, в качестве рассыльщика используется postfix. 
 
Опишем структуру. Я опишу структуру системы подписки, которую я разработал работая в РБТШ.   
В последнее время мне кажется, что основная проблема в современной разработке лежит в области культуры кодирования. Есть прекрасные книги, которые рассказывают как писать хороший код. Есть отличные книги, которые описывают что такое патерны и как их применять. Есть даже ресурс который описывает, какой код писать нельзя. Но в тоже время когда ты видишь то иногда хочется очень очень сильно надавать тому человеку, который его писал и проектировал
Давайте представим, что мы хотим сделать сервис подписок. Сервис будет немного сложнее чем подразумевается обычно: у нас будет не одна подписка, а две например. И человек сможет подписаться на одну, на обе или ни на одну. Кроме этого человек сможет отписываться от конкретной подписки, и потом подписываться еще раз. Обычно переход от 1 к 2 - является очень сложным. Переход от 2 к 3 ... - уже тривиален. Обычно у нас есть форма подписки, где человек может подписаться на сайт. 
Мы постараемся ничего не хардкодить, чтобы все переходы можно было легко проделать для любого количества подписок. 
Для начала опишем макроуровень нашей системы:
В системе будет объект подписка